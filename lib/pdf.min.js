// PDF.js Minimal Implementation for PDF Preview
// This is a lightweight PDF rendering solution

class PDFViewer {
    constructor() {
        this.pdfDoc = null;
        this.pageNum = 1;
        this.pageCount = 0;
        this.scale = 1.5;
    }
    
    async loadPDF(pdfData) {
        try {
            // Create a blob URL from base64 data
            const binaryString = atob(pdfData.split(',')[1]);
            const bytes = new Uint8Array(binaryString.length);
            for (let i = 0; i < binaryString.length; i++) {
                bytes[i] = binaryString.charCodeAt(i);
            }
            const blob = new Blob([bytes], { type: 'application/pdf' });
            const url = URL.createObjectURL(blob);
            
            return { url, pageCount: 1 }; // Simplified - just provide download link
        } catch (error) {
            console.error('PDF loading error:', error);
            throw error;
        }
    }
    
    renderPage(canvas, pageNum = 1) {
        // Simplified PDF rendering - show placeholder
        const ctx = canvas.getContext('2d');
        ctx.fillStyle = '#374151';
        ctx.fillRect(0, 0, canvas.width, canvas.height);
        
        ctx.fillStyle = '#00f3ff';
        ctx.font = '48px Arial';
        ctx.textAlign = 'center';
        ctx.fillText('ðŸ“„', canvas.width / 2, canvas.height / 2 - 40);
        
        ctx.fillStyle = '#ffffff';
        ctx.font = '18px Arial';
        ctx.fillText('PDF Document', canvas.width / 2, canvas.height / 2 + 20);
        
        ctx.fillStyle = '#9ca3af';
        ctx.font = '14px Arial';
        ctx.fillText('Click download to view full document', canvas.width / 2, canvas.height / 2 + 45);
    }
}

// Global PDF.js-like interface
window.pdfjsLib = {
    getDocument: async (src) => {
        const viewer = new PDFViewer();
        return await viewer.loadPDF(src);
    },
    GlobalWorkerOptions: {
        workerSrc: '/lib/pdf.worker.js'
    }
};

// Export for module usage
if (typeof module !== 'undefined' && module.exports) {
    module.exports = { PDFViewer };
}