// Download and File Handling Functionality
class DownloadHandler {
  constructor() {
    this.init();
  }

  init() {
    this.setupDownloadButtons();
    this.setupFileHandlers();
  }

  setupDownloadButtons() {
    // Portfolio download functionality
    const downloadButtons = document.querySelectorAll('[data-download]');
    downloadButtons.forEach(button => {
      button.addEventListener('click', (e) => {
        const downloadType = e.target.getAttribute('data-download');
        this.handleDownload(downloadType);
      });
    });
  }

  setupFileHandlers() {
    // File input handlers for admin
    const fileInputs = document.querySelectorAll('input[type="file"]');
    fileInputs.forEach(input => {
      input.addEventListener('change', (e) => {
        this.handleFileUpload(e);
      });
    });
  }

  handleDownload(type) {
    switch (type) {
      case 'resume':
        this.downloadResume();
        break;
      case 'portfolio':
        this.downloadPortfolio();
        break;
      case 'messages':
        this.downloadMessages();
        break;
      default:
        console.warn('Unknown download type:', type);
    }
  }

  downloadResume() {
    // Create a sample resume file
    const resumeContent = this.generateResumeContent();
    this.downloadFile(resumeContent, 'Shahmeer_Baqai_Resume.txt', 'text/plain');
  }

  downloadPortfolio() {
    // Create portfolio summary
    const portfolioContent = this.generatePortfolioContent();
    this.downloadFile(portfolioContent, 'Shahmeer_Baqai_Portfolio.txt', 'text/plain');
  }

  downloadMessages() {
    // Download messages as JSON (admin only)
    if (window.adminPanel && window.adminPanel.isLoggedIn) {
      window.adminPanel.exportMessages();
    } else {
      alert('Admin access required');
    }
  }

  downloadFile(content, filename, mimeType) {
    const blob = new Blob([content], { type: mimeType });
    const url = URL.createObjectURL(blob);
    
    const link = document.createElement('a');
    link.href = url;
    link.download = filename;
    link.style.display = 'none';
    
    document.body.appendChild(link);
    link.click();
    document.body.removeChild(link);
    
    URL.revokeObjectURL(url);
  }

  handleFileUpload(event) {
    const file = event.target.files[0];
    if (!file) return;

    const reader = new FileReader();
    
    reader.onload = (e) => {
      try {
        // Handle different file types
        if (file.type === 'application/json') {
          this.handleJSONUpload(e.target.result);
        } else if (file.type.startsWith('text/')) {
          this.handleTextUpload(e.target.result);
        } else {
          console.warn('Unsupported file type:', file.type);
        }
      } catch (error) {
        console.error('Error processing file:', error);
        alert('Error processing file');
      }
    };

    reader.readAsText(file);
  }

  handleJSONUpload(content) {
    try {
      const data = JSON.parse(content);
      // Handle JSON data import (e.g., messages)
      if (window.adminPanel && Array.isArray(data)) {
        window.adminPanel.importMessages(data);
      }
    } catch (error) {
      alert('Invalid JSON file');
    }
  }

  handleTextUpload(content) {
    // Handle text file uploads
    console.log('Text file uploaded:', content);
  }

  generateResumeContent() {
    return `
SHAHMEER BAQAI
Digital Strategist & Content Creator
Email: contact@shahmeerbaqai.com
Portfolio: https://shahmeerbaqai-portfolio-pro.pages.dev/

PROFESSIONAL SUMMARY
===================
Experienced digital strategist with 10+ years in copywriting, content creation, and AI-powered marketing solutions. Specialized in creating high-converting ads, viral video content, and comprehensive digital marketing strategies that drive measurable results.

CORE COMPETENCIES
================
‚Ä¢ High-Converting Copywriting (10+ years)
‚Ä¢ Content Writing & Strategy (10+ years)
‚Ä¢ Academic Writing (5+ years)
‚Ä¢ SEO Writing & Optimization
‚Ä¢ Graphic Design & AI Visuals
‚Ä¢ Video Services & Production
‚Ä¢ Video Editing & Post-Production
‚Ä¢ Web Development & Programming
‚Ä¢ Social Media Marketing
‚Ä¢ App Development

ACHIEVEMENTS
===========
‚Ä¢ 1000+ satisfied clients across various industries
‚Ä¢ Generated 5M+ video views for client content
‚Ä¢ Tripled conversion rates for multiple clients
‚Ä¢ Expert in AI-powered content creation tools
‚Ä¢ Developed custom web applications and Chrome extensions

SERVICES OFFERED
===============
‚Ä¢ Facebook, Instagram, TikTok ad copy
‚Ä¢ AI-powered viral video creation
‚Ä¢ Ghostwriting for books, podcasts, and scripts
‚Ä¢ Email marketing campaigns
‚Ä¢ Pinterest marketing strategies
‚Ä¢ Web tools and AI system development

CONTACT
=======
Ready to discuss your next project and create content that converts.
Portfolio: https://portfolio-files.pages.dev/
    `.trim();
  }

  generatePortfolioContent() {
    return `
SHAHMEER BAQAI - DIGITAL PORTFOLIO
==================================

OVERVIEW
========
Digital strategist specializing in high-converting copy and AI-powered video content. 
10+ years of experience helping brands achieve breakthrough results through strategic content creation.

KEY SERVICES
===========

üöÄ High-Converting Ads
‚Ä¢ Facebook, Instagram, TikTok campaigns
‚Ä¢ Copy that sells in 3 seconds
‚Ä¢ Proven track record of increased conversions

üé• Viral Short Videos
‚Ä¢ AI-powered visuals and music
‚Ä¢ Content designed to stop the scroll
‚Ä¢ 5M+ views generated for clients

üìö Ghostwriting Services
‚Ä¢ True crime content
‚Ä¢ Book writing and editing
‚Ä¢ YouTube scripts in your voice
‚Ä¢ Podcast content creation

üìß Email Marketing
‚Ä¢ Newsletter campaigns that convert
‚Ä¢ High open and click-through rates
‚Ä¢ Sales-focused email sequences

üìå Pinterest Marketing
‚Ä¢ High-CTR pin designs
‚Ä¢ Traffic and revenue driving strategies
‚Ä¢ Pinterest SEO optimization

üõ†Ô∏è Web Tools & AI Development
‚Ä¢ Chrome extensions
‚Ä¢ Custom AI systems
‚Ä¢ Web application development

PROFESSIONAL EXPERTISE
======================
‚úçÔ∏è Copywriting - 10 Years Experience
üìù Content Writing - 10 Years Experience  
üéì Academic Writing - 5 Years Experience
üîç SEO Writing - Latest Expertise
üé® Graphic Design - Latest Expertise
üé¨ Video Services - Latest Expertise
‚úÇÔ∏è Video Editing - Latest Expertise
üíª Web Development - Latest Expertise
üì± Social Marketing - Latest Expertise
üì± App Development - Latest Expertise

CLIENT TESTIMONIALS
==================
"Shahmeer tripled our conversion rate in 2 weeks. His ads are pure profit engines." 
- Sarah K., Marketing Director

"His AI videos went viral ‚Äî 5M views in 3 days. Unreal reach and engagement." 
- James L., Founder

"Shahmeer ghostwrote my podcast ‚Äî sounds exactly like me, but better. 10/10." 
- Alex R., Podcaster

PORTFOLIO SAMPLES
================
View complete portfolio: https://portfolio-files.pages.dev/

CONTACT INFORMATION
==================
Ready to start your next project? Let's create something amazing together.

Website: https://shahmeerbaqai-portfolio-pro.pages.dev/
Portfolio: https://portfolio-files.pages.dev/
    `.trim();
  }

  // Utility function to format file sizes
  formatFileSize(bytes) {
    if (bytes === 0) return '0 Bytes';
    const k = 1024;
    const sizes = ['Bytes', 'KB', 'MB', 'GB'];
    const i = Math.floor(Math.log(bytes) / Math.log(k));
    return parseFloat((bytes / Math.pow(k, i)).toFixed(2)) + ' ' + sizes[i];
  }

  // Generate portfolio data as JSON
  generatePortfolioData() {
    return {
      personal: {
        name: "Shahmeer Baqai",
        title: "Digital Strategist",
        subtitle: "High-Converting Copy & AI Videos That Sell",
        experience: "10+ years",
        clients: "1000+",
        videoViews: "5M+"
      },
      services: [
        {
          title: "üöÄ High-Converting Ads",
          description: "Facebook, Instagram, TikTok ‚Äî copy that sells in 3 seconds."
        },
        {
          title: "üé• Viral Short Videos",
          description: "AI-powered visuals + music that stop the scroll."
        },
        {
          title: "üìö Ghostwriting",
          description: "True crime, books, YouTube scripts ‚Äî in your voice."
        },
        {
          title: "üìß Email That Converts",
          description: "Newsletters that get opens, clicks, and sales."
        },
        {
          title: "üìå Pinterest That Sells",
          description: "High-CTR pins that drive traffic and revenue."
        },
        {
          title: "üõ†Ô∏è Web Tools & AI",
          description: "Chrome extensions, AI systems, and custom apps."
        }
      ],
      skills: [
        { name: "Copywriting", experience: "10 Years", level: "Expert" },
        { name: "Content Writing", experience: "10 Years", level: "Expert" },
        { name: "Academic Writing", experience: "5 Years", level: "Expert" },
        { name: "SEO Writing", experience: "Latest Expertise", level: "Expert" },
        { name: "Graphic Design", experience: "Latest Expertise", level: "Expert" },
        { name: "Video Services", experience: "Latest Expertise", level: "Expert" },
        { name: "Video Editing", experience: "Latest Expertise", level: "Expert" },
        { name: "Web Development", experience: "Latest Expertise", level: "Expert" },
        { name: "Social Marketing", experience: "Latest Expertise", level: "Expert" },
        { name: "App Development", experience: "Latest Expertise", level: "Expert" }
      ],
      testimonials: [
        {
          stars: 5,
          text: "Shahmeer tripled our conversion rate in 2 weeks. His ads are pure profit engines.",
          author: "Sarah K., Marketing Director"
        },
        {
          stars: 5,
          text: "His AI videos went viral ‚Äî 5M views in 3 days. Unreal reach and engagement.",
          author: "James L., Founder"
        },
        {
          stars: 5,
          text: "Shahmeer ghostwrote my podcast ‚Äî sounds exactly like me, but better. 10/10.",
          author: "Alex R., Podcaster"
        }
      ],
      contact: {
        website: "https://shahmeerbaqai-portfolio-pro.pages.dev/",
        portfolio: "https://portfolio-files.pages.dev/"
      }
    };
  }
}

// Initialize download handler
document.addEventListener('DOMContentLoaded', () => {
  new DownloadHandler();
});

// Export for global use
window.DownloadHandler = DownloadHandler;